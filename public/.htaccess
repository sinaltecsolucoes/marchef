# Habilita o motor de reescrita de URLs
RewriteEngine On

# Define o caminho base para projetos em subpastas
RewriteBase /marchef/public/

# ----------------------------------------------------------------------
# REGRA 1: Redirecionar acesso direto a scripts .php
# ----------------------------------------------------------------------
# CONDIÇÕES: Aplica a regra abaixo apenas se...
# 1. A requisição original do navegador foi para um arquivo .php
RewriteCond %{THE_REQUEST} \.php
# 2. E a requisição NÃO é para o index.php
RewriteCond %{REQUEST_URI} !/index\.php$ [NC]
# 3. E a requisição NÃO é para o ajax_router.php
RewriteCond %{REQUEST_URI} !/ajax_router\.php$ [NC]

# AÇÃO: Se as 3 condições forem verdadeiras, redireciona para a raiz do site.
RewriteRule .* /marchef/public/ [R=301,L]

# ----------------------------------------------------------------------
# REGRA 2: Roteamento de URLs para o Controlador Frontal
# ----------------------------------------------------------------------
# CONDIÇÕES: Aplica a regra abaixo apenas se...
# ... a requisição NÃO for para um arquivo que existe (css, js, img, etc).
RewriteCond %{REQUEST_FILENAME} !-f
# ... e a requisição NÃO for para um diretório que existe.
RewriteCond %{REQUEST_FILENAME} !-d

# AÇÃO: Se as condições forem verdadeiras, envia a requisição para o index.php.
RewriteRule . index.php [L,QSA]